<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>

<style>

	@import 'reset.css';

	icon-wrapper {
		display: block;
		max-width: 40px;
		margin-left: 40px;
	}

	img {
		display: block;
		width: 100%;
		height: auto;
	}

	.category {
		background: #ffea9c;
	}

	.product-list {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
		gap: 20px;
	}

	summary {
		display: flex;
	}

	summary h2 {
		vertical-align: middle;
		font-size: 48px;
	}

/*	summary::marker {
		content: none;
	}*/

/*	summary::after {
		content: url("./red-triangle.svg");
	}

	details[open] summary::after {
		content: '';
	}*/

	li {
	/*display: block;*/
		border: 2px solid black;
		background: red;
		padding: 20px;
	}

	svg path {
		fill: #ff4560;
	}

</style>


</head>
<body>
	<main></main>

<script>
	console.clear();

	const outlet = document.querySelector('main');

	async function fetchData() {
		try {
			var response = await fetch('https://raw.githubusercontent.com/neodigm/FED_Programming_Challenge/gh-pages/products.json');
			return response.json();
		} catch(error) {
			console.log(error);
		}
	}

	async function transformData() {

		var object = await fetchData();	
		var transformedObject = object.reduce(function(acc, item) {

			//Look at each item currently in the accumulator (there won't be any if this is the first loop) and check the "name" value of that object against the "cat" value of the current item. Each object's "name" value will be unique.
			var existingCategory = acc.find(function(element) {
				return element.name === item.cat;
			});

			//If that name value doesn't exist yet, add a new {} to the accumulator with that "name" value and push the individual item values within this object.
			if (!existingCategory) {
				acc.push({
					name: item.cat,
					products: [
						{
							name: item.product,
							price: parseFloat(item.price),
							sale: parseFloat(item.sale)
						}
					]
				});

			//If an object with that "name" value already exists, simply make a new item with the current item's data and push it to the matching object that shares a "cat" value with the "name" value.	
			} else {
				existingCategory.products.push({
				name: item.product,
				price: parseFloat(item.price),
				sale: parseFloat(item.sale)
			});
			}
			return acc;
		}, []);
		return transformedObject;
	}

	async function renderData() {
		
		var array = await transformData();

		function renderCategories(categories) {
			var template = `<ul class="category-list">`;
			//Each list item in here is a category name in the JSON.
			// for(let i = 0; i < store.length; i++) {
			// 	template += `<li>${store[i].name}</li>`
			// }
			array.forEach(function(category) {
				template += `<li class='category'>${renderCategory(category)}</li>`;
			})
			template += `</ul>`;
			outlet.innerHTML = template;
		}

		function renderCategory(category) {
			var template = `
					<details>
						<summary>
							<h2>${category.name}</h2>
							<icon-wrapper>
								<svg width="100%" height="100%" viewBox="0 0 347 400" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><path d="M346.326,199.957l-346.326,199.958l-0,-399.915l346.326,199.957Z"/></svg>
							</icon-wrapper>
						</summary>
						<div class="products">${renderProducts(category.products)}</div>
					</details>
					`;
			return template;	
		}

		function renderProducts(products) {
			var template = `<ul class="product-list">`;
			//for each product that matches the category,
			//return the product.
			products.forEach(function(product) {
				template += `<li>${renderProduct(product)}</li>`;		
			})
			template +=	`</ul>`;
			return template;
		}

		function renderProduct(product) {
			return `
				<product-card>
					<h1 class="name">${product.name}</h1>
					<p class="price">${product.price}</p>
					<button class="favorite">favorite</button>
				</product-card>
			`;
		}
		
		renderCategories(array);
	}

	//Execute the functions from the above list.

	renderData();

	

		const svgPath = document.querySelector('path');
		const categories = document.querySelectorAll('.category');

		categories.addEventListener("toggle", (event) => {
		
			//when the class of details is open,
			//transform and do a color change.
			if(!event.target.open) {
				svgPath.style.fill = '#45ff5c';
			} else {
				svgPath.style.fill = '#ff4560';
			}
			console.log('events were logged');
		});
	




</script>
</body>
</html>


	