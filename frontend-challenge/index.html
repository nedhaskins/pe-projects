<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>

<style>

	@import 'reset.css';

	html {
		--neonFuchsia: #ff4560;
	}

	body {
		padding: 5px;
	}

	.category {
		border: 2px solid black;
		background-color: white;
		color: black;
		font-family: 'Arial', sans-serif;
		letter-spacing: 0.06em;
		font-style: italic;
	}

	/*SVG attributes*/

	icon-wrapper {
		max-width: 35px;
	}

	svg path {
		fill: red;	
	}

	details[open] svg {
		transform: rotate(90deg);
	}

	.category {
		padding: 10px;
	}

	.product-list {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
		gap: 20px;
		margin-top: 20px;
	}

	.product-list li {
		border: 2px solid red;
		padding: 20px;
	}
	summary {
		display: flex;
	}

	summary h2 {
		vertical-align: middle;
		font-size: 48px;
	}

	/* details #triangle {
		width: 0;
		height: 0;
		border-top: 20px solid transparent;
		border-right: 20px solid transparent;
		border-bottom: 20px solid transparent;
		border-left: 34.641px solid var(--neonFuchsia);
	}

	details[open] #triangle {
		animation-name: rotate;
		animation-duration: 0.5s;
	} */

	@keyframes rotate {
	  0% {
	    transform: rotate(0);
	  }
	  100% {
	    transform: rotate(90deg);
	  }
	}



	icon-wrapper {
		display: block;
		margin-left: 30px;
		margin-top: 6px;
	}

	button.favorited {
		background-color: yellow;
	}

	button.not-favorited {
		background-color: unset;
	}

</style>


</head>
<body>
	<main></main>

<script>
	
	console.clear();

	//Initialize local storage and place all favorites data into an accessible object.
	var favorites = [];

	const data = JSON.parse( localStorage.getItem('favorites') ) || [];
	data.forEach((item) => {
		favorites = [...favorites, item];
	});

	//Set up an area to put event listeners.
	const outlet = document.querySelector('main');


	//Cascading async functions.

	async function fetchData() {
		try {
			var response = await fetch('https://raw.githubusercontent.com/neodigm/FED_Programming_Challenge/gh-pages/products.json');
			return response.json();
		} catch(error) {
			console.log(error);
		}
	}

	async function transformData() {

		var object = await fetchData();	
		var transformedObject = object.reduce(function(acc, item) {

			//Look at each item currently in the accumulator (there won't be any if this is the first loop) and check the "name" value of that object against the "cat" value of the current item. Each object's "name" value will be unique.
			var existingCategory = acc.find(function(element) {
				return element.name === item.cat;
			});

			//If that name value doesn't exist yet, add a new {} to the accumulator with that "name" value and push the individual item values within this object.
			if (!existingCategory) {
				acc.push({
					name: item.cat,
					products: [
						{
							name: item.product,
							price: parseFloat(item.price),
							sale: parseFloat(item.sale)
						}
					]
				});

			//If an object with that "name" value already exists, simply make a new item with the current item's data and push it to the matching object that shares a "cat" value with the "name" value.	
			} else {
				existingCategory.products.push({
				name: item.product,
				price: parseFloat(item.price),
				sale: parseFloat(item.sale)
			});
			}
			return acc;
		}, []);
		return transformedObject;
	}

	async function renderData() {
		
		var array = await transformData();

		function renderCategories(categories) {
			var template = `<ul class="category-list">`;
			//Each list item in here is a category name in the JSON.
			// for(let i = 0; i < store.length; i++) {
			// 	template += `<li>${store[i].name}</li>`
			// }
			array.forEach(function(category) {
				template += `<li class='category' data-id="${category.name}">${renderCategory(category)}</li>`;
			})
			template += `</ul>`;
			outlet.innerHTML = template;
		}

		function renderCategory(category) {
			var template = `
					<details>
						<summary>
							<h2>${category.name}</h2>
														<icon-wrapper>
								<svg width="100%" height="100%" viewBox="0 0 347 400" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><path d="M346.326,199.957l-346.326,199.958l-0,-399.915l346.326,199.957Z"/></svg>
							</icon-wrapper>
						</summary>
						<div class="products">${renderProducts(category.products)}</div>
					</details>
					`;
			return template;	
		}

		function renderProducts(products) {
			var template = `<ul class="product-list">`;
			//for each product that matches the category,
			//return the product.
			products.forEach(function(product) {
				template += `<li>${renderProduct(product)}</li>`;		
			})
			template +=	`</ul>`;
			return template;
		}

		function renderProduct(product) {
			return `
				<product-card data-id="${product.name}">
					<h1 class="name">${product.name}</h1>
					<p class="price">${product.price}</p>
					<p class="sale">${product.sale}</p>
					<button class="not-favorited">not favorited</button>
				</product-card>
			`;
		}

		// function addEventListeners() {
		// 	const svgPath = document.querySelector('path');
		// 	const categories = document.querySelectorAll('.category');

		// 	categories.addEventListener("click", (event) => {
			
		// 		//when the class of details is open,
		// 		//transform and do a color change.
		// 		if(!event.target.open) {
		// 			svgPath.style.fill = '#45ff5c';
		// 		} else {
		// 			svgPath.style.fill = '#ff4560';
		// 		}
		// 		console.log('events were logged');
		// });}

		
		renderCategories(array);
		// addEventListeners();
	}

	//Execute the functions from the above list.

	renderData();




	outlet.addEventListener('click', (event) => {

		if(event.target.tagName === 'BUTTON') {
			const productName = event.target.closest('product-card').dataset.id;
			const category = event.target.closest('.category').dataset.id;
			const price = outlet.querySelector('.price').textContent; 
			const sale = outlet.querySelector('.sale').textContent;
		

			if(event.target.className === 'not-favorited') {
				
				const product = {
					category: category,
					name: productName,
					price: price,
					sale: sale,
				}

				favorites.push(product);
				localStorage.setItem('favorites', JSON.stringify(favorites));
				console.log(`${productName} was aved to local storage successfully`, favorites);
		
				event.target.className = 'favorited';
				event.target.style.backgroundColor = 'pink';
				event.target.textContent = 'favorited';

			} else if(event.target.className === 'favorited') {

				const filtered = favorites.filter(product => product.name != productName);
			
				favorites = [...filtered];
				localStorage.setItem('favorites', JSON.stringify(favorites));
				console.log(`${productName} was removed from local storage.`, favorites)
				

				event.target.className = 'not-favorited';
				event.target.style.backgroundColor = 'unset';
				event.target.textContent = 'not favorited';
			}
		}
	})

</script>
</body>
</html>


	